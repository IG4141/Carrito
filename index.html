<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrito de Compras</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="css/custom.css" rel="stylesheet" />
</head>
<body class="p-4">

  <!-- Icono del carrito -->
  <button class="cart-btn" id="cartBtn">ðŸ›’
    <span class="cart-badge" id="cartBadge">0</span>
  </button>
  
  <!-- Pop up del carrito -->
  <div class="cart-popup" id="cartPopup">
    <div class="cart-popup-header">Tu Carrito</div>
    <div id="cartPopupItems"></div>
    <div class="cart-popup-total">Total: $<span id="popupTotal">0</span></div>
    <div class="cart-popup-buttons">
      <button class="btn-empty-cart" onclick="vaciarCarrito()">Vaciar</button>
      <button class="btn-buy" onclick="comprar()">Comprar</button>
    </div>
    <button class="cart-popup-close" onclick="toggleCartPopup()">Cerrar</button>
  </div>

  <div class="container">
    <h1 class="mb-4 text-center main-title">Carrito de Compras Virtual</h1>

    <!-- Lista de productos disponibles -->
    <h3>Productos disponibles</h3>
    <div id="listaProductos" class="row g-3 mb-5"></div>
  </div>

  <script>
    const productos = [
      { id: 1, nombre: "Camiseta unicolor manga corta", precio: 20, cantidad: 1, imagen: "img/kmiseta.png" },
      { id: 2, nombre: "Pantalones Jean Rotos", precio: 35, cantidad: 1, imagen: "img/jean r.png" },
      { id: 3, nombre: "Zapatillas Salomon X Ultra 360", precio: 50, cantidad: 1, imagen: "img/zapas.png" },
      { id: 4, nombre: "Chaqueta de cuero real", precio: 60, cantidad: 1, imagen: "img/chaqueta.png" },
      { id: 5, nombre: "Gorro Beanie unicolor cuff", precio: 15, cantidad: 1, imagen: "img/gorro uni.png" },
      { id: 6, nombre: "Medias pata de pollo", precio: 8, cantidad: 1, imagen: "img/medias pollo.png" }
    ];

    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

    const listaProductos = document.getElementById("listaProductos");
    const cartPopupItems = document.getElementById("cartPopupItems");
    const popupTotal = document.getElementById("popupTotal");
    const cartBtn = document.getElementById("cartBtn");
    const cartPopup = document.getElementById("cartPopup");
    const cartBadge = document.getElementById("cartBadge");

    // Abrir pop up del carrito
    function toggleCartPopup() {
      cartPopup.classList.toggle("active");
    }

    cartBtn.addEventListener("click", toggleCartPopup);

    // Renderizar productos disponibles
    function mostrarProductos() {
      listaProductos.innerHTML = "";
      productos.forEach(prod => {
        listaProductos.innerHTML += `
          <div class="col-md-4">
            <div class="card product-card p-3 shadow-sm">
              <div class="product-image"><img src="${prod.imagen}" alt="${prod.nombre}"></div>
              <h5 class="card-title text-capitalize">${prod.nombre}</h5>
              <p>Precio: $${prod.precio}</p>
              <button class="btn btn-success w-100" onclick="agregarProducto(${prod.id})">Agregar</button>
            </div>
          </div>`;
      });
    }

    // Agregar producto al carrito
    function agregarProducto(id) {
      const prod = productos.find(p => p.id === id);
      const item = carrito.find(p => p.id === id);

      if (item) {
        item.cantidad++;
      } else {
        carrito.push({ ...prod });
      }

      guardarYRender();
    }

    // Mostrar carrito en popup
    function mostrarCarrito() {
      cartPopupItems.innerHTML = "";
      let total = 0;
      let itemCount = 0;

      if (carrito.length === 0) {
        cartPopupItems.innerHTML = '<p style="text-align: center; color: #999; padding: 20px 0;">Tu carrito estÃ¡ vacÃ­o</p>';
        cartBadge.classList.remove("active");
      } else {
        carrito.forEach(prod => {
          total += prod.precio * prod.cantidad;
          itemCount += prod.cantidad;
          cartPopupItems.innerHTML += `
            <div class="cart-popup-item">
              <span>${prod.nombre}</span>
              <span style="font-weight: bold;">x${prod.cantidad}</span>
            </div>`;
        });
        cartBadge.textContent = itemCount;
        cartBadge.classList.add("active");
      }

      popupTotal.textContent = total;
    }

    function guardarYRender() {
      localStorage.setItem("carrito", JSON.stringify(carrito));
      mostrarCarrito();
    }

    // Vaciar carrito
    function vaciarCarrito() {
      carrito = [];
      guardarYRender();
    }

    // FunciÃ³n para comprar
    function comprar() {
      if (carrito.length === 0) {
        alert("Tu carrito esta vacio, vas a comprar aire?");
        return;
      }
      window.open("comprakappa.html", "_blank");
    }

    mostrarProductos();
    mostrarCarrito();
  </script>

</body>
</html>
